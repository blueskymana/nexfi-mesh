#!/bin/sh
# usage: mp.sh <add | del> <mesh_iface> <ifname> <ssid> <channel>.

# command directory
IW=/usr/sbin/iw
IFCONFIG=/sbin/ifconfig
IFUP=/sbin/ifup


# usage.
usage() {
    echo "usage: mp.sh <add | del> <mesh_iface> <ifname> <ssid> <channel>."
}

# functions
add_mesh() {
    ${IW}           dev $1 interface add $2 type mp
    ${IFCONFIG}     $1 down
    ${IFCONFIG}     $2 down
    ${IW}           dev $2 set type mp
    ${IW}           dev $2 set meshid $3
    ${IW}           dev $2 set channel $4
    ${IFCONFIG}     $2 up
}

del_mesh() {
    ${IW}           dev $1 del
}

# logic
if [ "$1" = "add" ] && [ "$#" -eq 5 ];
then
    add_mesh $3 $2 $4 $5
elif [ "$1" = "del" ] && [ "$#" -eq 2 ];
then
    del_mesh $2
else
    usage
fi

